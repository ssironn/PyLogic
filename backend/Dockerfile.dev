# PyLogic Backend - Development Dockerfile with Live Reload
# ============================================================
#
# Este Dockerfile é para desenvolvimento com auto-reload do Flask.
#
# Uso:
#   docker build -f Dockerfile.dev -t pylogic-backend-dev ./backend
#   docker run -p 9000:5000 -v $(pwd)/backend:/app pylogic-backend-dev
#
# ============================================================

FROM python:3.11-slim

WORKDIR /app

# Instala dependências do sistema
RUN apt-get update && apt-get install -y \
    build-essential \
    curl \
    default-mysql-client \
    && rm -rf /var/lib/apt/lists/*

# Copia e instala dependências
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Instala watchdog para auto-reload
RUN pip install watchdog

# Copia o código (será sobrescrito pelo volume em dev)
COPY . .

# Make entrypoint executable
RUN chmod +x /app/entrypoint.sh

EXPOSE 5000

# Ambiente de desenvolvimento
ENV FLASK_APP=api.py
ENV FLASK_ENV=development
ENV FLASK_DEBUG=1
ENV PYTHONUNBUFFERED=1
ENV DATABASE_HOST=mysql

ENTRYPOINT ["/bin/bash", "/app/entrypoint.sh"]
# Usa flask run com reload ativado
CMD ["flask", "run", "--host=0.0.0.0", "--port=5000", "--reload", "--debugger"]
